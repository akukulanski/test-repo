language: python

stages:
- docker_img
- testing

jobs:
    include:
    - stage: docker_img
      before_install:
      - './login_docker.sh'
      - 'docker pull $DOCKER_USERNAME/test-reg' 
      script:
      - echo "---stage Docker, script---"
      - './login_docker.sh'
      - 'docker build -t docker_image -f .gci/dockerfile .'
      - 'docker run -it docker_image echo "stage docker: docker run"'
      after_success:
      - 'docker tag docker_image $DOCKER_USERNAME/test-reg'
      - 'docker push $DOCKER_USERNAME/test-reg'
    - stage: testing
      before_install:
      - './login_docker.sh'
      - 'docker pull $DOCKER_USERNAME/test-reg'
      script:
      - echo "Ac√° corre el test"
      - 'docker run -it $DOCKER_USERNAME/test-reg echo "stage test: docker run"'

#services:
#    - docker

#before_install:
#    - echo "---before install---"

#install:
#    - echo "---install---"

#before_script:
#    - echo "---before script---"

#before_cache:
#    - echo "---before cache---"

#before_deploy:
#    - echo "---before deploy---"

#deploy:
#    - echo "---deploy---"

#after_deploy:
#    - echo "---after deploy---"

#after_script:
#    - echo "---after script---"

#after_success:
#    - echo "---after success---"
#    - echo "Test Success - Branch($TRAVIS_BRANCH) Pull Request($TRAVIS_PULL_REQUEST) Tag($TRAVIS_TAG)"
#    - if [[ "$TRAVIS_BRANCH" == "master" ]]; then echo -e "---master!---"; fi

#after_failure:
#    - echo "---after failure---"
# https://travis-ci.community/t/how-to-skip-jobs-based-on-the-files-changed-in-a-subdirectory/2979/11
